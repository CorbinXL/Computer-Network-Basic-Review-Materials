计算机网络期末复习

# 第一章 计算机网络
## 计算机网络向用户提供的最重要的两大功能
* 连通性
* 共享

## Internet的构成

### 边缘部分
边缘部分就是连接在因特网上的所有的主机。边缘部分利用核心部分提供的服务，使众多主机之间能够互相通信并交换信息或共享信息。

#### 组成
* 端系统 & 主机
* 运行网络应用程序
* 处在网络边缘


### 核心网络
网络中的核心部分由许多路由器实现互连，向网络边缘中的主机提供连通性，使边缘部分中的任何一个主机都能够向其他主机通信。

#### 组成
* 交换机
* 路由器

### 如何把边缘部分接入到核心网络
#### 点对点
* 拨号线路使用modem：56Kbps
* ISDN：128Kbps
* ADSL：上512Kbps，下4MKbps

#### Cable Modem
* HFC：上2Mbps，下30Mbps

#### FTTP
光线入户

#### WIFI

#### LAN

### 物理介质
#### 双绞线
两根彼此绝缘、相互缠绕成螺旋状的铜线。缠绕的目的是减少电磁干扰，提高传输质量
##### 分类：
* 屏蔽双绞线
* 非屏蔽双绞线

#### 同轴线缆
* 两根彼此绝缘的同心导体
* 双向传输

#### 光纤线缆
* 高速传输
* 低误码率 
* 防止电磁干扰
* 难以被分光窃听

#### 无线电波
* 地面微博
* 局域无限通道
* 广域无限通道
* 卫星通信



## 两大类服务
### 面向连接服务：TCP
* 可靠、顺序、字节流传输: 
    * 丢失: 确认和重传
* 流量控制: 
    * 发送者不至于淹没接收者
* 拥塞控制: 
    * 当网络拥塞时发送者降低发送速率


### 非面向连接服务：UDP
* 不可靠数据传输
* 无流量控制
* 无拥塞控制

## 数据交换分类
### 电路交换
* FDMA
* TDMA
一定面向连接
独占链路资源

### 分组交换
* 所有分组共享网络资源 
* 每个分组使用全部链路带宽 
* 资源按需使用 

#### 数据报
* 分组目的地址决定下一跳
* 会话期间路由可以改变
* 比方: 驱车逐段问路 

#### 虚拟电路
* 每个分组有1个标签  (虚电路号,virtual circuit ID), 标签决定下1跳
* 连接建立时确定固定的路径, 并且将保持于整个会话期间
* 路由器必须为每个连接维护状态信息


## 延迟
### 处理时延
差错检测
TTL建议
生成校验和
查询路由表
### 排队时延
流量强度=La/R
### 传输时延
### 传播时延

## TCP/IP参考模型（网络体系结构）
### 应用层
单位：报文
HTTP
SMTP
DNS
实现应用程序的特定协议
实现应用程序的逻辑控制
### 运输层
单位：TCP数据段、UDP数据报
实现进程到进程的通信
面向连接通信
无连接通信
### 网络层
主机到主机的通信
实现路由和转发
分组
### 网络接口层
链路层
物理层
实现数据帧和二进制的发送过程控制
实现数据和信号的转换
实现异构网络的屏蔽

## OSA参考模型
### 应用层
### 表示层
### 会话层
### 运输层
### 网络层
### 链路层
### 物理层

# 第二章 应用层
## 应用层体系结构
### C/S
* 服务器： 
	* 总是打开的主机
	* 具有固定的、众所周知的IP地址
	* 主机群集常被用于创建强大的虚拟服务器
* 客户机:
	* 同服务器端通信
	* 可以间断的同服务器连接
	* 可以拥有动态IP地址
	* 客户机相互之间不直接通信

### P2P
* 没有总是打开的服务器
* 任意一对主机直接相互通信
* 对等方间歇连接并且可以改变IP地址
* 优点：自扩展性
* 缺点：难以管理


### 混合
* 文件直接在对等方之间交换
* 文件搜索通过服务器
    * 中心服务器记录对等方内容
    * 对等方查询中心服务器来决定要求的文件位置


## 浏览网页的实现
网页是由很多文件形成的集合
### HTTP
无状态协议：每一次请求和响应是独立的
使用TCP协议
#### 过程：
* 客户初始化一个与HTTP服务器**80端口**的TCP连接 (创建套接字)
* HTTP服务器接受来自客户的TCP连接请求, 建立连接
* Browser (HTTP client)和Web服务器 (HTTP server) 交换HTTP消息(应用层协议消息)包括HTTP请求和响应消息
* 最后结束(或叫关闭)TCP连接

#### 非持久HTTP
* 建立TCP
* 请求html文件
* 建立多个TCP
* 请求多个对象
总共4个TTL

#### 持久HTTP
* 建立TCP连接
* 请求html
* 请求多个对象

#### 带流水线
3个

#### 流水线
n+1个

### 报文格式
使用ASCII文本
#### 请求报文
* 请求行
    * GET URL version
* 头部行
    * Host
    * Agent
    * Connetion
    * Language
* 空行+回车换行
* 实体主体

#### 响应报文
* 状态行
    * version 200（状态码） OK
* 首部行
    * Connection
    * Date
    * Serve
    * Last-modified
    * Length
    * Type

### 方法类型
* GET
* POST
* HEAD
* PUT
* DELETE


### cookies
无状态条件下实现用户身份跟踪
每一个请求需要携带cookie id

### web缓存
快速响应
降低接入链路层流量
整体降低web流量

#### 具体响应过程
缓存向服务器发送条件get（if modified since）确认对象是否被更新了
304 not modified
200 ok

## 电子邮件
用户代理
邮件服务器
邮件协议
7位SCII码

### SMTP
* SMTP使用持久连接
* SMTP 要求邮件消息(header & body)必须是7-bit ASCII
* SMTP服务器使用CRLF.CRLF 来判断邮件消息的结束

### 发送邮件
SMTP
HTTP

### 接收邮件
POP3 端口 120
IMAP 端口 143
HTTP

### 服务器之间
只使用SMTP
SMTP使用运输层TCP协议
默认端口号：25端口

### 邮件消息要求
7位ASCII码
多媒体使用MIME

## DNS
主机名转换为IP地址
主机别名
邮件服务器别名
负载分配

### 解析
#### 递归解析
#### 迭代解析

### 数据库
采用分布式数据库

### 架构
根域名服务器
顶级域名服务器
权威域名服务器
本地域名服务器

### 4个RR
#### 四个变量
name 
value 
type 
ttl

#### 格式（Type）
A 规范主机名 IP
NS 域名 权威域名服务器
CNAME 别名 规范主机名
MX 邮件地址别名 邮件服务器规范主机名


# 第三章 传输层 TCP UDP

## UDP
目的IP地址
目的端口号

### 固定首部8字节
* 原端口
* 目的端口
* 长度
* 校验和

### 校验和计算
* 将数据每**16位**分为一组
* 将所有**数据组**相加
* 例如：

> 0110 0110 0110 0000
> 0101 0101 0101 0101
> 1000 1111 0000 1100

* 依次相加，在**第二次相加后**得到了

> **1** 0100 1010 1100 0001
> 注意出现了第**17位**

* 将第17位的1加至第一位得到

> 0100 1010 1100 0001 + 1
> 0100 1010 1100 0010

* 取反码

> 1011 0101 0011 1101

### 伪首部12字节
* 源IP地址（4字节）
* 目的IP地址（4字节）
* 保留字节，全置0（1字节）
* 传输协议号（1字节）
* 报文长度（2字节）

在计算检验和时，临时把“伪首部”和 UDP 用户数据报连接在一起。伪首部仅仅是为了计算检验和。


## TCP
* 全双工数据：同一个连接上的双向数据流
* MSS: 最大报文段长
* 面向连接：在数据交换前握手(交换控制信息) 初始化发送方和接收方的状态
* 流量控制：发送方不会淹没接收方

### 连接管理
#### 建立连接
Step 1: 客户发送`TCP SYN`报文段到服务器，指定**初始的序号**，**没有数据**
Step 2: 服务器接收`SYN`, 回复`SYNACK`报文段，服务器分配**缓冲区**，指定服务器的**初始序号**
Step 3: 客户接收`SYNACK`, 回复`ACK`报文段, 可能**包含数据**

* 客户初始序列号：x，发送TCP SYN请求

```
SYN=1，Seq=x
```
* 服务器初始序号y，发送TCP SYNACK，确认客户SYN

```
ACK=1; 
ACKnum=x+1
SYN=1, Seq=y
```
* 接收SYNACK(x) ，发送ACK确认SYNACK，可以携带数据

```
ACK=1, 
ACKnum=y+1
```

第一次请求连接
SYN = 1
ACK = 0
返回
SYN = 1
ACK = 1
再次确认
SYN = 0
ACK = 1
#### 关闭连接
Step 1: 客户发送`TCP FIN`控制报文段到服务器 
Step 2: 服务器接收`FIN`, 回复`ACK`半关闭连接, 并发送`FIN`到客户
Step 3: 客户接收`FIN`, 回复`ACK`，进入 **“timed wait”**，等待结束时释放连接资源
Step 4: 服务器接收`ACK`，连接关闭. 

```
客户端：FIN=1，seq=x
服务器：ACK=1，ACKnum = X+1
服务器：FIN=1，seq=y
客户端：ACK=1，ACKnum = y+1
```

### 可靠数据传输
#### 平等协议
发送请求，启动定时器
等待返回
请求下一个
只有在超时时才会重新发送
#### 流水线协议
都使用了滑动窗口
##### 回退验证
略
##### 选择性重传
序号大小和窗口大小的关系：小于或等于序号空间大小的一半
#### TCP融合了两者优势
##### 发送窗口
* 窗口第一个未被确认位置设置定时器，确认则向后滑动
* 超时重发
* 三次重复确认重发

##### 接收窗口
* 收到有序分组，且该分组前面全部被确认，先等待500ms；
* 如果收到报文前面有未被确认报文，立即发送确认；
* 如果报文失序，立即返回确认；
* 可以填充空隙，立刻返回确认。

### 流量控制
发送窗口小于等于接收窗口
传输报文中有一个字段指示窗口大小
### 拥塞控制
AIMD
慢启动
拥塞避免
快速恢复：三次重复确认


# 第四章 网络层
## 网络层协议
### 转发选路
转发 内部
选路 整个网络

### 路由器工作原理
输入端口
交换结构
输出端口
路由处理器

### IP报文
目的IP
源IP
版本号

### IP分片和重组
大到小分片
最终接收方重组

### IP编址
#### 分类IP
ABC 单播
D 组播
E 保留未用
#### 不分类IP
前缀表示网络
### 子网
子网划分
子网掩码
## DHCP协议
DISCOVER
OFFER
REQUEST
ACK
NACK
RELEASE
租用期 & 续租

## NAT
对输出分组 替换原端口号、IP为NAT端口号、NATIP
将替换记录至NAT转发表
对进入分组 同样替换

## IPV6
扩展地址长度32到128
和IPV4:双栈、隧道

## VPN

## 路由算法
### 链路状态
### 距离向量
### 层次选路
### RAP
### OSPF
### BGP & BGP-4









